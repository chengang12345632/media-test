# å¸¸è§é—®é¢˜è§£å†³

## CORSé—®é¢˜

### é—®é¢˜æè¿°
å‰ç«¯æ— æ³•è®¿é—® `http://localhost:8080` çš„API

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1: ä¿®å¤å¹³å°æœåŠ¡å™¨å¯åŠ¨é€»è¾‘

ä¿®æ”¹ `platform-server/src/main.rs`:

```rust
// å¹¶å‘è¿è¡Œä¸¤ä¸ªæœåŠ¡å™¨
let quic_handle = tokio::spawn(async move {
    if let Err(e) = quic_server.run().await {
        tracing::error!("QUIC server error: {}", e);
    }
});

let http3_handle = tokio::spawn(async move {
    if let Err(e) = http3_server.run().await {
        tracing::error!("HTTP3 server error: {}", e);
    }
});

tokio::try_join!(quic_handle, http3_handle)?;
```

#### éªŒè¯ä¿®å¤

```powershell
Invoke-RestMethod -Uri "http://localhost:8080/api/v1/health"
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "status": "success",
  "data": "OK"
}
```

---

## H.264æ’­æ”¾é—®é¢˜

### é—®é¢˜æè¿°
H.264æ–‡ä»¶ä¸åŒ…å«NALèµ·å§‹ç ï¼Œæ— æ³•è¢«mux.jsæ­£ç¡®è§£æ

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1: ä½¿ç”¨MP4æ–‡ä»¶ï¼ˆæ¨èï¼‰

ç›´æ¥ä½¿ç”¨MP4æ ¼å¼çš„è§†é¢‘æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œæ— éœ€ä»»ä½•è½¬æ¢ã€‚

å½“å‰æµ‹è¯•ç›®å½•ä¸­å·²æœ‰çš„MP4æ–‡ä»¶ï¼š
- `device-simulator/test-videos/sample_60fps_audio.mp4`
- `device-simulator/test-videos/sample1.mp4`
- `device-simulator/test-videos/oceans.mp4`

#### æ–¹æ¡ˆ2: ç”Ÿæˆæ ‡å‡†Annex Bæ ¼å¼çš„H.264æ–‡ä»¶

```bash
# ä»MP4æå–H.264è£¸æµï¼ˆAnnex Bæ ¼å¼ï¼‰
ffmpeg -i input.mp4 -c:v copy -bsf:v h264_mp4toannexb -an output.h264

# æˆ–è€…é‡æ–°ç¼–ç 
ffmpeg -i input.mp4 -c:v libx264 -an -f h264 output.h264
```

#### æ£€æŸ¥H.264æ–‡ä»¶æ ¼å¼

```bash
# Windows
certutil -encodehex file.h264 - 32 | more

# Linux/Mac
hexdump -C file.h264 | head -n 5
```

æ­£ç¡®çš„Annex Bæ ¼å¼åº”è¯¥ä»¥ä»¥ä¸‹å­—èŠ‚å¼€å¤´ï¼š
- `00 00 00 01` (4å­—èŠ‚èµ·å§‹ç )
- æˆ– `00 00 01` (3å­—èŠ‚èµ·å§‹ç )

---

## ç›´é€šæ’­æ”¾é—®é¢˜

### é—®é¢˜1: ç›´é€šæ’­æ”¾æŒ‰é’®æ˜¯ç°è‰²çš„

**åŸå› **: è®¾å¤‡ä¸åœ¨çº¿

**è§£å†³**:
1. æ£€æŸ¥è®¾å¤‡æ¨¡æ‹Ÿå™¨æ˜¯å¦è¿è¡Œ
2. æŸ¥çœ‹è®¾å¤‡çŠ¶æ€æ˜¯å¦ä¸º "ğŸŸ¢ åœ¨çº¿"
3. ç­‰å¾…å‡ ç§’é’Ÿè®©è®¾å¤‡è¿æ¥

### é—®é¢˜2: ç‚¹å‡»åæ²¡æœ‰ååº”

**æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°**:
```javascript
// æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
// æŸ¥çœ‹ Console æ ‡ç­¾
```

**æ£€æŸ¥ç½‘ç»œè¯·æ±‚**:
```javascript
// åœ¨ Network æ ‡ç­¾ä¸­æŸ¥æ‰¾:
// POST http://localhost:8080/api/v1/stream/start
// çŠ¶æ€åº”è¯¥æ˜¯ 200 OK
```

### é—®é¢˜3: è§†é¢‘æ— æ³•æ’­æ”¾

**æ£€æŸ¥**:
1. æ˜¯å¦æˆåŠŸè·³è½¬åˆ°æ’­æ”¾å™¨é¡µé¢
2. æ’­æ”¾å™¨æ˜¯å¦æ˜¾ç¤º "æ­£åœ¨è¿æ¥ç›´é€šæ’­æ”¾..."
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

**è§£å†³**:
- åˆ·æ–°é¡µé¢é‡è¯•
- æ£€æŸ¥SSEè¿æ¥æ˜¯å¦å»ºç«‹
- æŸ¥çœ‹å¹³å°æœåŠ¡å™¨æ—¥å¿—

---

## æœåŠ¡å¯åŠ¨é—®é¢˜

### é—®é¢˜: ç«¯å£è¢«å ç”¨

**æ£€æŸ¥ç«¯å£å ç”¨**:
```powershell
netstat -ano | findstr "8080"
netstat -ano | findstr "8443"
netstat -ano | findstr "5173"
```

**è§£å†³**: å…³é—­å ç”¨ç«¯å£çš„è¿›ç¨‹

### é—®é¢˜: è®¾å¤‡ä¸åœ¨çº¿

**æŸ¥çœ‹è®¾å¤‡æ—¥å¿—**:
```powershell
$jobIds = Get-Content ".job-ids.json" | ConvertFrom-Json
Receive-Job -Id $jobIds.Device -Keep | Select-Object -Last 50
```

**æŸ¥æ‰¾**: `âœ“ Connected to platform server`

---

## æµè§ˆå™¨å…¼å®¹æ€§

### WebCodecsæ”¯æŒæ£€æŸ¥

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š

```javascript
// æ£€æŸ¥WebCodecsæ”¯æŒ
console.log('WebCodecs:', 'VideoDecoder' in window ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ')

// æ£€æŸ¥H.264ç¼–è§£ç å™¨æ”¯æŒ
if ('VideoDecoder' in window) {
  VideoDecoder.isConfigSupported({
    codec: 'avc1.42E01E',
    optimizeForLatency: true
  }).then(result => {
    console.log('H.264 Baseline:', result.supported ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ')
  })
}
```

### æ¨èæµè§ˆå™¨

- Chrome 94+ âœ…
- Edge 94+ âœ…
- Safari 16.4+ âœ…
- Firefox âŒï¼ˆå®éªŒæ€§æ”¯æŒï¼‰

---

**æ›´æ–°æ—¶é—´**: 2025-12-13
