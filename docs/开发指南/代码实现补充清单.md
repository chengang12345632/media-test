# ä»£ç å®ç°è¡¥å……æ¸…å•

## ğŸ“‹ æ¦‚è¿°

åŸºäºç°æœ‰çš„æ¶æ„è®¾è®¡æ–‡æ¡£ï¼Œè¦å®ç°å®Œæ•´çš„HTTP3/QUICè§†é¢‘æµä¼ è¾“ç³»ç»Ÿï¼Œè¿˜éœ€è¦è¡¥å……ä»¥ä¸‹å†…å®¹ã€‚

---

## ğŸ¯ æ ¸å¿ƒè¡¥å……å†…å®¹

### 1. é¡¹ç›®é…ç½®æ–‡ä»¶ âœ…

#### å¿…é¡»åˆ›å»ºçš„é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| `Cargo.toml` | æ ¹ç›®å½• | Cargoå·¥ä½œç©ºé—´é…ç½® |
| `Cargo.toml` | platform-server/ | å¹³å°ç«¯ä¾èµ– |
| `Cargo.toml` | device-simulator/ | è®¾å¤‡ç«¯ä¾èµ– |
| `Cargo.toml` | common/ | å…±äº«åº“ä¾èµ– |
| `package.json` | web-frontend/ | å‰ç«¯ä¾èµ– |
| `config.toml` | platform-server/ | å¹³å°ç«¯é…ç½® |
| `config.toml` | device-simulator/ | è®¾å¤‡ç«¯é…ç½® |
| `.env` | web-frontend/ | å‰ç«¯ç¯å¢ƒå˜é‡ |

### 2. å…±äº«ä»£ç åº“ âœ…

éœ€è¦åˆ›å»º `common` åŒ…ï¼ŒåŒ…å«ï¼š

```
common/
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src/
    â”œâ”€â”€ lib.rs              # åº“å…¥å£
    â”œâ”€â”€ types.rs            # æ ¸å¿ƒæ•°æ®ç»“æ„
    â”œâ”€â”€ protocol.rs         # åè®®å®šä¹‰
    â”œâ”€â”€ error.rs            # é”™è¯¯ç±»å‹
    â””â”€â”€ utils.rs            # å·¥å…·å‡½æ•°
```

**å…³é”®ç±»å‹**:
- `VideoSegment` - è§†é¢‘åˆ†ç‰‡
- `ProtocolMessage` - åè®®æ¶ˆæ¯
- `DeviceInfo` - è®¾å¤‡ä¿¡æ¯
- `RecordingInfo` - å½•åƒä¿¡æ¯
- `MessageType` - æ¶ˆæ¯ç±»å‹æšä¸¾

### 3. å¹³å°ç«¯æ ¸å¿ƒæ¨¡å— âœ…

```
platform-server/src/
â”œâ”€â”€ main.rs                 # å…¥å£æ–‡ä»¶
â”œâ”€â”€ config.rs               # é…ç½®ç®¡ç†
â”œâ”€â”€ logging.rs              # æ—¥å¿—ç³»ç»Ÿ
â”‚
â”œâ”€â”€ quic/                   # QUICæœåŠ¡å™¨
â”‚   â”œâ”€â”€ server.rs
â”‚   â”œâ”€â”€ connection.rs
â”‚   â””â”€â”€ stream.rs
â”‚
â”œâ”€â”€ http3/                  # HTTP3æœåŠ¡å™¨
â”‚   â”œâ”€â”€ server.rs
â”‚   â”œâ”€â”€ handlers.rs
â”‚   â””â”€â”€ routes.rs
â”‚
â”œâ”€â”€ protocol/               # åè®®è½¬æ¢
â”‚   â”œâ”€â”€ converter.rs
â”‚   â”œâ”€â”€ quic_to_http3.rs
â”‚   â””â”€â”€ http3_to_quic.rs
â”‚
â”œâ”€â”€ device/                 # è®¾å¤‡ç®¡ç†
â”‚   â”œâ”€â”€ manager.rs
â”‚   â”œâ”€â”€ registry.rs
â”‚   â””â”€â”€ heartbeat.rs
â”‚
â”œâ”€â”€ recording/              # å½•åƒç®¡ç†
â”‚   â”œâ”€â”€ manager.rs
â”‚   â”œâ”€â”€ scanner.rs
â”‚   â””â”€â”€ metadata.rs
â”‚
â”œâ”€â”€ distribution/           # åˆ†å‘ç®¡ç†
â”‚   â”œâ”€â”€ manager.rs
â”‚   â”œâ”€â”€ subscriber.rs
â”‚   â””â”€â”€ quality.rs
â”‚
â””â”€â”€ latency/                # å»¶è¿Ÿç›‘æ§
    â”œâ”€â”€ monitor.rs
    â”œâ”€â”€ statistics.rs
    â””â”€â”€ alert.rs
```

### 4. è®¾å¤‡ç«¯æ ¸å¿ƒæ¨¡å— âœ…

```
device-simulator/src/
â”œâ”€â”€ main.rs                 # å…¥å£æ–‡ä»¶
â”œâ”€â”€ config.rs               # é…ç½®ç®¡ç†
â”œâ”€â”€ logging.rs              # æ—¥å¿—ç³»ç»Ÿ
â”‚
â”œâ”€â”€ quic/                   # QUICå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ client.rs
â”‚   â”œâ”€â”€ connection.rs
â”‚   â””â”€â”€ reconnect.rs
â”‚
â”œâ”€â”€ video/                  # è§†é¢‘æ–‡ä»¶è¯»å–
â”‚   â”œâ”€â”€ reader.rs
â”‚   â”œâ”€â”€ h264_parser.rs
â”‚   â””â”€â”€ mp4_parser.rs
â”‚
â”œâ”€â”€ segmenter/              # åˆ†ç‰‡å™¨
â”‚   â”œâ”€â”€ frame.rs
â”‚   â”œâ”€â”€ gop.rs
â”‚   â””â”€â”€ fixed.rs
â”‚
â”œâ”€â”€ controller/             # æ’­æ”¾æ§åˆ¶
â”‚   â”œâ”€â”€ playback.rs
â”‚   â”œâ”€â”€ seek.rs
â”‚   â””â”€â”€ rate.rs
â”‚
â”œâ”€â”€ index/                  # å…³é”®å¸§ç´¢å¼•
â”‚   â”œâ”€â”€ keyframe.rs
â”‚   â”œâ”€â”€ builder.rs
â”‚   â””â”€â”€ search.rs
â”‚
â””â”€â”€ uploader/               # ä¸Šä¼ å™¨
    â”œâ”€â”€ scheduler.rs
    â”œâ”€â”€ stats.rs
    â””â”€â”€ adaptive.rs
```

### 5. å‰ç«¯æ ¸å¿ƒæ¨¡å— âœ…

```
web-frontend/src/
â”œâ”€â”€ main.tsx                # å…¥å£æ–‡ä»¶
â”œâ”€â”€ App.tsx                 # ä¸»ç»„ä»¶
â”‚
â”œâ”€â”€ components/             # Reactç»„ä»¶
â”‚   â”œâ”€â”€ VideoPlayer.tsx
â”‚   â”œâ”€â”€ ControlPanel.tsx
â”‚   â”œâ”€â”€ DeviceList.tsx
â”‚   â”œâ”€â”€ RecordingList.tsx
â”‚   â””â”€â”€ PerformanceMonitor.tsx
â”‚
â”œâ”€â”€ services/               # APIæœåŠ¡
â”‚   â”œâ”€â”€ http3Client.ts
â”‚   â”œâ”€â”€ api.ts
â”‚   â””â”€â”€ websocket.ts
â”‚
â”œâ”€â”€ hooks/                  # è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ useDevices.ts
â”‚   â”œâ”€â”€ useRecordings.ts
â”‚   â””â”€â”€ usePlayback.ts
â”‚
â””â”€â”€ types/                  # TypeScriptç±»å‹
    â”œâ”€â”€ api.ts
    â”œâ”€â”€ device.ts
    â””â”€â”€ recording.ts
```

---

## ğŸ“¦ ä¾èµ–åº“æ¸…å•

### Rustä¾èµ–

#### QUICå’ŒHTTP3
- `quinn = "0.10"` - QUICå®ç°
- `h3 = "0.0.3"` - HTTP/3å®ç°
- `h3-quinn = "0.0.4"` - Quinnçš„HTTP/3ç»‘å®š
- `rustls = "0.21"` - TLSå®ç°

#### Webæ¡†æ¶
- `axum = "0.7"` - Webæ¡†æ¶
- `tower = "0.4"` - ä¸­é—´ä»¶
- `tower-http = "0.5"` - HTTPä¸­é—´ä»¶

#### å¼‚æ­¥è¿è¡Œæ—¶
- `tokio = "1.35"` - å¼‚æ­¥è¿è¡Œæ—¶
- `futures = "0.3"` - Futureå·¥å…·

#### åºåˆ—åŒ–
- `serde = "1.0"` - åºåˆ—åŒ–æ¡†æ¶
- `serde_json = "1.0"` - JSONæ”¯æŒ
- `bincode = "1.3"` - äºŒè¿›åˆ¶åºåˆ—åŒ–

#### æ—¥å¿—
- `tracing = "0.1"` - æ—¥å¿—æ¡†æ¶
- `tracing-subscriber = "0.3"` - æ—¥å¿—è®¢é˜…å™¨

#### å·¥å…·
- `uuid = "1.6"` - UUIDç”Ÿæˆ
- `chrono = "0.4"` - æ—¶é—´å¤„ç†
- `dashmap = "5.5"` - å¹¶å‘HashMap
- `lru = "0.12"` - LRUç¼“å­˜
- `walkdir = "2.4"` - ç›®å½•éå†

#### è§†é¢‘å¤„ç†
- `mp4 = "0.14"` - MP4è§£æ
- `h264-reader = "0.7"` - H.264è§£æ

### TypeScript/JavaScriptä¾èµ–

#### æ ¸å¿ƒæ¡†æ¶
- `react = "^18.2.0"` - Reactæ¡†æ¶
- `react-dom = "^18.2.0"` - React DOM
- `typescript = "^5.3.0"` - TypeScript

#### æ„å»ºå·¥å…·
- `vite = "^5.0.0"` - æ„å»ºå·¥å…·
- `@vitejs/plugin-react = "^4.2.0"` - Reactæ’ä»¶

#### å¼€å‘å·¥å…·
- `eslint = "^8.55.0"` - ä»£ç æ£€æŸ¥
- `prettier = "^3.1.0"` - ä»£ç æ ¼å¼åŒ–

---

## ğŸ”§ å…³é”®å®ç°è¦ç‚¹

### 1. QUICæœåŠ¡å™¨å®ç°

```rust
// æ ¸å¿ƒä»£ç æ¡†æ¶
pub struct QuicServer {
    endpoint: Endpoint,
    connections: Arc<DashMap<Uuid, Connection>>,
}

impl QuicServer {
    pub async fn new(config: ServerConfig, addr: SocketAddr) -> Result<Self>;
    pub async fn run(&self) -> Result<()>;
    async fn handle_connection(&self, conn: quinn::Connecting) -> Result<()>;
}
```

### 2. HTTP3æœåŠ¡å™¨å®ç°

```rust
// æ ¸å¿ƒä»£ç æ¡†æ¶
pub fn create_router() -> Router {
    Router::new()
        .route("/api/v1/devices", get(handlers::get_devices))
        .route("/api/v1/devices/:device_id/live-stream", 
               post(handlers::start_live_stream))
        // ... å…¶ä»–è·¯ç”±
}
```

### 3. åè®®è½¬æ¢å™¨å®ç°

```rust
// æ ¸å¿ƒä»£ç æ¡†æ¶
pub struct ProtocolConverter {
    quic_sessions: Arc<DashMap<Uuid, QUICSession>>,
    http3_clients: Arc<DashMap<String, HTTP3Client>>,
}

impl ProtocolConverter {
    pub async fn convert_quic_to_http3(&self, segment: VideoSegment) -> Result<()>;
    pub async fn convert_http3_to_quic(&self, control: PlaybackControl) -> Result<()>;
}
```

### 4. è§†é¢‘æ’­æ”¾å™¨å®ç°

```typescript
// æ ¸å¿ƒä»£ç æ¡†æ¶
export const VideoPlayer: React.FC<VideoPlayerProps> = ({ sessionId }) => {
  const videoRef = useRef<HTMLVideoElement>(null);
  const [mediaSource, setMediaSource] = useState<MediaSource | null>(null);
  
  // MediaSourceåˆå§‹åŒ–
  useEffect(() => {
    const ms = new MediaSource();
    videoRef.current.src = URL.createObjectURL(ms);
    // ...
  }, []);
  
  // æ¥æ”¶è§†é¢‘åˆ†ç‰‡
  useEffect(() => {
    const ws = new WebSocket(`wss://localhost:8443/api/v1/stream/${sessionId}/events`);
    ws.onmessage = handleSegment;
    // ...
  }, [sessionId]);
  
  return <video ref={videoRef} controls />;
};
```

---

## ğŸ“… å®ç°æ—¶é—´è§„åˆ’

### æ€»ä½“æ—¶é—´: 10å‘¨

| é˜¶æ®µ | å‘¨æ•° | ä¸»è¦ä»»åŠ¡ |
|------|------|---------|
| é˜¶æ®µ1 | ç¬¬1å‘¨ | é¡¹ç›®åˆå§‹åŒ–ã€å…±äº«åº“ |
| é˜¶æ®µ2 | ç¬¬2-4å‘¨ | å¹³å°ç«¯æ ¸å¿ƒæ¨¡å— |
| é˜¶æ®µ3 | ç¬¬5-6å‘¨ | è®¾å¤‡ç«¯å®ç° |
| é˜¶æ®µ4 | ç¬¬7-8å‘¨ | å‰ç«¯å¼€å‘ |
| é˜¶æ®µ5 | ç¬¬9å‘¨ | é›†æˆæµ‹è¯• |
| é˜¶æ®µ6 | ç¬¬10å‘¨ | ä¼˜åŒ–å’Œæ–‡æ¡£ |

---

## âœ… å®ç°æ£€æŸ¥æ¸…å•

### é¡¹ç›®åˆå§‹åŒ–
- [ ] åˆ›å»ºCargoå·¥ä½œç©ºé—´
- [ ] åˆ›å»ºcommonå…±äº«åº“
- [ ] é…ç½®Gitå’Œ.gitignore
- [ ] é…ç½®å¼€å‘å·¥å…·ï¼ˆrustfmt, clippyï¼‰

### å¹³å°ç«¯
- [ ] QUICæœåŠ¡å™¨
- [ ] HTTP3æœåŠ¡å™¨
- [ ] åè®®è½¬æ¢å™¨
- [ ] è®¾å¤‡ç®¡ç†å™¨
- [ ] å½•åƒç®¡ç†å™¨
- [ ] åˆ†å‘ç®¡ç†å™¨
- [ ] å»¶è¿Ÿç›‘æ§å™¨

### è®¾å¤‡ç«¯
- [ ] QUICå®¢æˆ·ç«¯
- [ ] è§†é¢‘æ–‡ä»¶è¯»å–å™¨
- [ ] åˆ†ç‰‡å™¨
- [ ] æ’­æ”¾æ§åˆ¶å™¨
- [ ] å…³é”®å¸§ç´¢å¼•
- [ ] ä¸Šä¼ å™¨

### å‰ç«¯
- [ ] HTTP3å®¢æˆ·ç«¯
- [ ] è§†é¢‘æ’­æ”¾å™¨ç»„ä»¶
- [ ] è®¾å¤‡ç®¡ç†ç»„ä»¶
- [ ] å½•åƒç®¡ç†ç»„ä»¶
- [ ] æ€§èƒ½ç›‘æ§ç»„ä»¶

### æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•

### æ–‡æ¡£
- [ ] APIæ–‡æ¡£
- [ ] éƒ¨ç½²æ–‡æ¡£
- [ ] å¼€å‘æ–‡æ¡£
- [ ] ç”¨æˆ·æ‰‹å†Œ

---

## ğŸ“ å­¦ä¹ èµ„æº

### Rustç›¸å…³
- [Rustå®˜æ–¹æ–‡æ¡£](https://doc.rust-lang.org/book/)
- [Quinnæ–‡æ¡£](https://docs.rs/quinn/)
- [Axumæ–‡æ¡£](https://docs.rs/axum/)
- [Tokioæ•™ç¨‹](https://tokio.rs/tokio/tutorial)

### QUIC/HTTP3
- [QUICåè®®RFC](https://www.rfc-editor.org/rfc/rfc9000.html)
- [HTTP/3åè®®RFC](https://www.rfc-editor.org/rfc/rfc9114.html)

### å‰ç«¯ç›¸å…³
- [Reactæ–‡æ¡£](https://react.dev/)
- [TypeScriptæ‰‹å†Œ](https://www.typescriptlang.org/docs/)
- [MediaSource API](https://developer.mozilla.org/en-US/docs/Web/API/MediaSource)

---

## ğŸ’¡ å¼€å‘å»ºè®®

### 1. å¼€å‘é¡ºåº
1. å…ˆå®ç°å…±äº«ç±»å‹å®šä¹‰
2. å†å®ç°å¹³å°ç«¯QUICæœåŠ¡å™¨
3. ç„¶åå®ç°è®¾å¤‡ç«¯QUICå®¢æˆ·ç«¯
4. æœ€åå®ç°å‰ç«¯æ’­æ”¾å™¨

### 2. è°ƒè¯•æŠ€å·§
- ä½¿ç”¨ `RUST_LOG=debug` å¯ç”¨è¯¦ç»†æ—¥å¿—
- ä½¿ç”¨WiresharkæŠ“åŒ…åˆ†æQUICæµé‡
- ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·è°ƒè¯•å‰ç«¯

### 3. æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯
- æ‰¹é‡å¤„ç†åˆ†ç‰‡
- å¼‚æ­¥å¹¶å‘å¤„ç†
- åˆç†ä½¿ç”¨ç¼“å­˜

### 4. ä»£ç è´¨é‡
- ç¼–å†™å•å…ƒæµ‹è¯•
- ä½¿ç”¨clippyæ£€æŸ¥ä»£ç 
- ä½¿ç”¨rustfmtæ ¼å¼åŒ–ä»£ç 
- è¿›è¡Œä»£ç å®¡æŸ¥

---

## ğŸ“ è·å–å¸®åŠ©

- ğŸ“– [å®Œæ•´å®ç°æŒ‡å—](./ä»£ç å®ç°æŒ‡å—.md)
- ğŸ“š [ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£](../ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£.md)
- ğŸ’» [å¼€å‘æ‰‹å†Œ](./å¼€å‘æ‰‹å†Œ.md)
- ğŸš€ [å¿«é€Ÿå¼€å§‹æŒ‡å—](./å¿«é€Ÿå¼€å§‹æŒ‡å—.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-12-12  
**ç»´æŠ¤è€…**: ç³»ç»Ÿæ¶æ„å›¢é˜Ÿ
