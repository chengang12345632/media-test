# HTTP3/QUICè§†é¢‘æµä¼ è¾“ç³»ç»Ÿ - éƒ¨ç½²æŒ‡å—

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| æ–‡æ¡£ç‰ˆæœ¬ | v1.0 |
| åˆ›å»ºæ—¥æœŸ | 2025-12-12 |
| é€‚ç”¨ç‰ˆæœ¬ | Demo v1.0 |
| éƒ¨ç½²æ¨¡å¼ | å•æœºæœ¬åœ°éƒ¨ç½² |

## ç›®å½•

1. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
2. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
3. [å¿«é€Ÿéƒ¨ç½²](#å¿«é€Ÿéƒ¨ç½²)
4. [è¯¦ç»†éƒ¨ç½²æ­¥éª¤](#è¯¦ç»†éƒ¨ç½²æ­¥éª¤)
5. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
6. [å¯åŠ¨å’Œåœæ­¢](#å¯åŠ¨å’Œåœæ­¢)
7. [éªŒè¯éƒ¨ç½²](#éªŒè¯éƒ¨ç½²)
8. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
9. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
10. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²](#ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²)

---

## ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

**æœ€ä½é…ç½®**ï¼š
- CPU: 4æ ¸å¿ƒ
- å†…å­˜: 8GB RAM
- ç£ç›˜: 100GB å¯ç”¨ç©ºé—´
- ç½‘ç»œ: 100Mbps

**æ¨èé…ç½®**ï¼š
- CPU: 8æ ¸å¿ƒæˆ–æ›´å¤š
- å†…å­˜: 16GB RAM
- ç£ç›˜: 500GB SSD
- ç½‘ç»œ: 1Gbps

### è½¯ä»¶è¦æ±‚

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|------|---------|------|
| æ“ä½œç³»ç»Ÿ | Windows 10/11, Linux, macOS | 64ä½ç³»ç»Ÿ |
| Rust | 1.70+ | å¹³å°ç«¯å’Œè®¾å¤‡ç«¯ |
| Node.js | 18+ | Webå‰ç«¯ |
| npm | 9+ | åŒ…ç®¡ç†å™¨ |

### ç½‘ç»œè¦æ±‚

- æ”¯æŒUDPåè®®ï¼ˆQUICåŸºäºUDPï¼‰
- å¼€æ”¾ç«¯å£ï¼š8080ï¼ˆQUICï¼‰ã€8443ï¼ˆHTTP3ï¼‰ã€3000ï¼ˆå‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼‰
- å¦‚æœ‰é˜²ç«å¢™ï¼Œéœ€è¦é…ç½®ç›¸åº”è§„åˆ™


---

## ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£…Rust

**Windows**ï¼š
```powershell
# ä¸‹è½½å¹¶è¿è¡Œ rustup-init.exe
# è®¿é—®: https://rustup.rs/

# éªŒè¯å®‰è£…
rustc --version
cargo --version
```

**Linux/macOS**ï¼š
```bash
# å®‰è£… Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# é…ç½®ç¯å¢ƒå˜é‡
source $HOME/.cargo/env

# éªŒè¯å®‰è£…
rustc --version
cargo --version
```

### 2. å®‰è£…Node.js

**Windows**ï¼š
```powershell
# ä¸‹è½½å¹¶å®‰è£… Node.js LTSç‰ˆæœ¬
# è®¿é—®: https://nodejs.org/

# éªŒè¯å®‰è£…
node --version
npm --version
```

**Linuxï¼ˆä½¿ç”¨nvmï¼‰**ï¼š
```bash
# å®‰è£… nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# å®‰è£… Node.js
nvm install 18
nvm use 18

# éªŒè¯å®‰è£…
node --version
npm --version
```

**macOSï¼ˆä½¿ç”¨Homebrewï¼‰**ï¼š
```bash
# å®‰è£… Homebrewï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# å®‰è£… Node.js
brew install node@18

# éªŒè¯å®‰è£…
node --version
npm --version
```

### 3. å…‹éš†é¡¹ç›®

```bash
# å…‹éš†é¡¹ç›®ä»“åº“
git clone https://github.com/your-org/video-streaming-demo.git
cd video-streaming-demo

# æŸ¥çœ‹é¡¹ç›®ç»“æ„
ls -la
```

**é¡¹ç›®ç›®å½•ç»“æ„**ï¼š
```
video-streaming-demo/
â”œâ”€â”€ platform-server/          # å¹³å°ç«¯æœåŠ¡å™¨
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ config.toml
â”œâ”€â”€ device-simulator/         # è®¾å¤‡æ¨¡æ‹Ÿå™¨
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”œâ”€â”€ config.toml
â”‚   â””â”€â”€ test-videos/         # æµ‹è¯•è§†é¢‘æ–‡ä»¶
â”œâ”€â”€ web-frontend/            # Webå‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ .env
â”œâ”€â”€ recordings/              # å½•åƒæ–‡ä»¶å­˜å‚¨
â”œâ”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ docs/                    # æ–‡æ¡£
```

---

## å¿«é€Ÿéƒ¨ç½²

### ä¸€é”®å¯åŠ¨è„šæœ¬

**Windows (PowerShell)**ï¼š
```powershell
# åˆ›å»ºå¯åŠ¨è„šæœ¬ start-all.ps1
@"
# å¯åŠ¨å¹³å°ç«¯æœåŠ¡å™¨
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd platform-server; cargo run --release"

# ç­‰å¾…5ç§’
Start-Sleep -Seconds 5

# å¯åŠ¨è®¾å¤‡æ¨¡æ‹Ÿå™¨
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd device-simulator; cargo run --release"

# ç­‰å¾…3ç§’
Start-Sleep -Seconds 3

# å¯åŠ¨Webå‰ç«¯
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd web-frontend; npm start"

Write-Host "æ‰€æœ‰æœåŠ¡å·²å¯åŠ¨ï¼"
Write-Host "è®¿é—® http://localhost:3000 æŸ¥çœ‹å‰ç«¯ç•Œé¢"
"@ | Out-File -FilePath start-all.ps1 -Encoding UTF8

# è¿è¡Œå¯åŠ¨è„šæœ¬
.\start-all.ps1
```

**Linux/macOS (Bash)**ï¼š
```bash
# åˆ›å»ºå¯åŠ¨è„šæœ¬ start-all.sh
cat > start-all.sh << 'EOF'
#!/bin/bash

# å¯åŠ¨å¹³å°ç«¯æœåŠ¡å™¨
cd platform-server
cargo run --release &
PLATFORM_PID=$!
echo "å¹³å°ç«¯æœåŠ¡å™¨å·²å¯åŠ¨ (PID: $PLATFORM_PID)"

# ç­‰å¾…5ç§’
sleep 5

# å¯åŠ¨è®¾å¤‡æ¨¡æ‹Ÿå™¨
cd ../device-simulator
cargo run --release &
DEVICE_PID=$!
echo "è®¾å¤‡æ¨¡æ‹Ÿå™¨å·²å¯åŠ¨ (PID: $DEVICE_PID)"

# ç­‰å¾…3ç§’
sleep 3

# å¯åŠ¨Webå‰ç«¯
cd ../web-frontend
npm start &
FRONTEND_PID=$!
echo "Webå‰ç«¯å·²å¯åŠ¨ (PID: $FRONTEND_PID)"

echo ""
echo "æ‰€æœ‰æœåŠ¡å·²å¯åŠ¨ï¼"
echo "å¹³å°ç«¯: PID $PLATFORM_PID"
echo "è®¾å¤‡ç«¯: PID $DEVICE_PID"
echo "å‰ç«¯: PID $FRONTEND_PID"
echo ""
echo "è®¿é—® http://localhost:3000 æŸ¥çœ‹å‰ç«¯ç•Œé¢"
echo ""
echo "åœæ­¢æ‰€æœ‰æœåŠ¡: kill $PLATFORM_PID $DEVICE_PID $FRONTEND_PID"
EOF

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x start-all.sh

# è¿è¡Œå¯åŠ¨è„šæœ¬
./start-all.sh
```


---

## è¯¦ç»†éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1: éƒ¨ç½²å¹³å°ç«¯æœåŠ¡å™¨

#### 1.1 ç¼–è¯‘å¹³å°ç«¯

```bash
cd platform-server

# é¦–æ¬¡ç¼–è¯‘ï¼ˆéœ€è¦ä¸‹è½½ä¾èµ–ï¼Œå¯èƒ½éœ€è¦5-10åˆ†é’Ÿï¼‰
cargo build --release

# ç¼–è¯‘å®Œæˆåï¼Œå¯æ‰§è¡Œæ–‡ä»¶ä½äºï¼š
# target/release/platform-server (Linux/macOS)
# target/release/platform-server.exe (Windows)
```

#### 1.2 é…ç½®å¹³å°ç«¯

ç¼–è¾‘ `platform-server/config.toml`ï¼š

```toml
[server]
# æœåŠ¡å™¨ç›‘å¬é…ç½®
quic_port = 8080              # QUICç«¯å£ï¼ˆè®¾å¤‡ç«¯è¿æ¥ï¼‰
http3_port = 8443             # HTTP3ç«¯å£ï¼ˆå‰ç«¯è¿æ¥ï¼‰
bind_address = "0.0.0.0"      # ç»‘å®šåœ°å€ï¼ˆ0.0.0.0è¡¨ç¤ºæ‰€æœ‰ç½‘å¡ï¼‰
max_concurrent_streams = 100  # æœ€å¤§å¹¶å‘æµæ•°é‡
latency_threshold_ms = 200    # å»¶è¿Ÿé˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰

[storage]
# å­˜å‚¨é…ç½®
recordings_root = "../recordings"  # å½•åƒæ–‡ä»¶æ ¹ç›®å½•
cache_size_mb = 1024              # è§†é¢‘åˆ†ç‰‡ç¼“å­˜å¤§å°ï¼ˆ1GBï¼‰
enable_cache = true               # æ˜¯å¦å¯ç”¨ç¼“å­˜

[recording_manager]
# å½•åƒç®¡ç†é…ç½®
scan_interval_sec = 300       # å½•åƒæ‰«æé—´éš”ï¼ˆ5åˆ†é’Ÿï¼‰
metadata_cache_size = 10000   # å…ƒæ•°æ®ç¼“å­˜æ•°é‡
auto_scan_on_startup = true   # å¯åŠ¨æ—¶è‡ªåŠ¨æ‰«æ

[logging]
# æ—¥å¿—é…ç½®
level = "info"                # æ—¥å¿—çº§åˆ«: trace, debug, info, warn, error
log_dir = "../logs"           # æ—¥å¿—ç›®å½•
log_to_console = true         # æ˜¯å¦è¾“å‡ºåˆ°æ§åˆ¶å°
log_to_file = true            # æ˜¯å¦è¾“å‡ºåˆ°æ–‡ä»¶
max_log_files = 10            # æœ€å¤§æ—¥å¿—æ–‡ä»¶æ•°é‡
max_log_size_mb = 100         # å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§å¤§å°

[demo]
# Demoæ¨¡å¼é…ç½®
no_auth = true                # æ— éœ€è®¤è¯
in_memory_storage = true      # ä½¿ç”¨å†…å­˜å­˜å‚¨è®¾å¤‡ä¿¡æ¯
enable_cors = true            # å¯ç”¨CORSï¼ˆè·¨åŸŸï¼‰
```

#### 1.3 åˆ›å»ºå¿…è¦ç›®å½•

```bash
# åˆ›å»ºå½•åƒå­˜å‚¨ç›®å½•
mkdir -p ../recordings

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p ../logs

# è®¾ç½®æƒé™ï¼ˆLinux/macOSï¼‰
chmod 755 ../recordings
chmod 755 ../logs
```

#### 1.4 å¯åŠ¨å¹³å°ç«¯

```bash
# æ–¹å¼1: ç›´æ¥è¿è¡Œ
cargo run --release

# æ–¹å¼2: è¿è¡Œç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶
./target/release/platform-server

# æ–¹å¼3: åå°è¿è¡Œï¼ˆLinux/macOSï¼‰
nohup ./target/release/platform-server > ../logs/platform.log 2>&1 &

# æ–¹å¼4: ä½¿ç”¨systemdï¼ˆLinuxç”Ÿäº§ç¯å¢ƒï¼‰
# è§ä¸‹æ–‡"ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"ç« èŠ‚
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—**ï¼š
```
[INFO] Platform server starting...
[INFO] QUIC server listening on 0.0.0.0:8080
[INFO] HTTP3 server listening on 0.0.0.0:8443
[INFO] Recording manager initialized
[INFO] Platform server ready!
```

### æ­¥éª¤2: éƒ¨ç½²è®¾å¤‡æ¨¡æ‹Ÿå™¨

#### 2.1 å‡†å¤‡æµ‹è¯•è§†é¢‘

```bash
cd device-simulator

# åˆ›å»ºæµ‹è¯•è§†é¢‘ç›®å½•
mkdir -p test-videos

# ä¸‹è½½æˆ–å¤åˆ¶æµ‹è¯•è§†é¢‘æ–‡ä»¶åˆ° test-videos ç›®å½•
# æ”¯æŒçš„æ ¼å¼: .h264, .264, .mp4, .m4v
```

**æµ‹è¯•è§†é¢‘è¦æ±‚**ï¼š
- æ ¼å¼: H.264è£¸æµ (.h264) æˆ– MP4å®¹å™¨ (.mp4)
- åˆ†è¾¨ç‡: å»ºè®®1920x1080æˆ–1280x720
- å¸§ç‡: 25-30 fps
- ç ç‡: 2-10 Mbps
- æ—¶é•¿: å»ºè®®10ç§’-10åˆ†é’Ÿ

**è·å–æµ‹è¯•è§†é¢‘**ï¼š
```bash
# æ–¹å¼1: ä½¿ç”¨ffmpegç”Ÿæˆæµ‹è¯•è§†é¢‘
ffmpeg -f lavfi -i testsrc=duration=60:size=1920x1080:rate=30 \
       -c:v libx264 -preset fast -crf 23 \
       test-videos/test_video_1080p_30fps.h264

# æ–¹å¼2: è½¬æ¢ç°æœ‰è§†é¢‘
ffmpeg -i input.mp4 -c:v libx264 -an test-videos/output.h264
```

#### 2.2 é…ç½®è®¾å¤‡æ¨¡æ‹Ÿå™¨

ç¼–è¾‘ `device-simulator/config.toml`ï¼š

```toml
[device]
# è®¾å¤‡åŸºæœ¬ä¿¡æ¯
device_id = "device_001"
device_name = "æ¨¡æ‹Ÿæ‘„åƒå¤´-01"
device_type = "simulator"

[connection]
# è¿æ¥é…ç½®
platform_url = "127.0.0.1:8080"  # å¹³å°ç«¯åœ°å€
reconnect_interval_sec = 5        # é‡è¿é—´éš”
max_retries = 5                   # æœ€å¤§é‡è¯•æ¬¡æ•°
recovery_strategy = "ExponentialBackoff"  # æ¢å¤ç­–ç•¥

[video]
# è§†é¢‘é…ç½®
test_videos_path = "./test-videos"
default_resolution = "1920x1080"
default_frame_rate = 30.0
segment_mode = "auto"  # auto, frame, gop, time

[performance]
# æ€§èƒ½é…ç½®
enable_monitoring = true
stats_interval_sec = 10
enable_network_adaptation = true

[keyframe_index]
# å…³é”®å¸§ç´¢å¼•é…ç½®
optimization_strategy = "Adaptive"  # Full, Sparse, Adaptive, Hierarchical
memory_limit_mb = 100
index_precision = 0.1  # 0.1ç§’ç²¾åº¦
```

#### 2.3 ç¼–è¯‘å’Œå¯åŠ¨è®¾å¤‡æ¨¡æ‹Ÿå™¨

```bash
# ç¼–è¯‘
cargo build --release

# å¯åŠ¨
cargo run --release

# æˆ–ç›´æ¥è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶
./target/release/device-simulator
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—**ï¼š
```
[INFO] Device simulator starting...
[INFO] Device ID: device_001
[INFO] Connecting to platform: 127.0.0.1:8080
[INFO] QUIC connection established
[INFO] Device registered successfully
[INFO] Found 3 test videos in ./test-videos
[INFO] Device simulator ready!
```


### æ­¥éª¤3: éƒ¨ç½²Webå‰ç«¯

#### 3.1 å®‰è£…ä¾èµ–

```bash
cd web-frontend

# å®‰è£…npmä¾èµ–ï¼ˆé¦–æ¬¡éœ€è¦3-5åˆ†é’Ÿï¼‰
npm install

# æˆ–ä½¿ç”¨yarn
yarn install
```

#### 3.2 é…ç½®å‰ç«¯

åˆ›å»ºæˆ–ç¼–è¾‘ `web-frontend/.env`ï¼š

```env
# å¹³å°ç«¯æœåŠ¡å™¨åœ°å€
REACT_APP_PLATFORM_URL=https://localhost:8443
REACT_APP_WS_URL=wss://localhost:8443

# Demoæ¨¡å¼
REACT_APP_DEMO_MODE=true

# å¼€å‘æœåŠ¡å™¨é…ç½®
PORT=3000
HTTPS=false

# å…¶ä»–é…ç½®
REACT_APP_API_TIMEOUT=30000
REACT_APP_WS_RECONNECT_INTERVAL=5000
REACT_APP_MAX_RECONNECT_ATTEMPTS=5
```

#### 3.3 å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
npm start

# æˆ–ä½¿ç”¨yarn
yarn start
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—**ï¼š
```
Compiled successfully!

You can now view video-streaming-frontend in the browser.

  Local:            http://localhost:3000
  On Your Network:  http://192.168.1.100:3000

Note that the development build is not optimized.
To create a production build, use npm run build.
```

#### 3.4 æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æ„å»ºäº§ç‰©ä½äº build/ ç›®å½•
ls -la build/

# ä½¿ç”¨é™æ€æœåŠ¡å™¨è¿è¡Œ
npx serve -s build -p 3000
```

---

## é…ç½®è¯´æ˜

### ç«¯å£é…ç½®

| æœåŠ¡ | é»˜è®¤ç«¯å£ | åè®® | è¯´æ˜ |
|------|---------|------|------|
| å¹³å°ç«¯-QUIC | 8080 | QUIC/UDP | è®¾å¤‡ç«¯è¿æ¥ |
| å¹³å°ç«¯-HTTP3 | 8443 | HTTP3/QUIC | å‰ç«¯è¿æ¥ |
| Webå‰ç«¯ | 3000 | HTTP | å¼€å‘æœåŠ¡å™¨ |

**ä¿®æ”¹ç«¯å£**ï¼š

1. ä¿®æ”¹å¹³å°ç«¯ç«¯å£ï¼šç¼–è¾‘ `platform-server/config.toml`
2. ä¿®æ”¹è®¾å¤‡ç«¯è¿æ¥åœ°å€ï¼šç¼–è¾‘ `device-simulator/config.toml`
3. ä¿®æ”¹å‰ç«¯è¿æ¥åœ°å€ï¼šç¼–è¾‘ `web-frontend/.env`

### é˜²ç«å¢™é…ç½®

**Windowsé˜²ç«å¢™**ï¼š
```powershell
# å…è®¸QUICç«¯å£ï¼ˆUDP 8080ï¼‰
New-NetFirewallRule -DisplayName "Video Streaming - QUIC" -Direction Inbound -Protocol UDP -LocalPort 8080 -Action Allow

# å…è®¸HTTP3ç«¯å£ï¼ˆUDP 8443ï¼‰
New-NetFirewallRule -DisplayName "Video Streaming - HTTP3" -Direction Inbound -Protocol UDP -LocalPort 8443 -Action Allow

# å…è®¸å‰ç«¯ç«¯å£ï¼ˆTCP 3000ï¼‰
New-NetFirewallRule -DisplayName "Video Streaming - Frontend" -Direction Inbound -Protocol TCP -LocalPort 3000 -Action Allow
```

**Linuxé˜²ç«å¢™ï¼ˆufwï¼‰**ï¼š
```bash
# å…è®¸QUICç«¯å£
sudo ufw allow 8080/udp

# å…è®¸HTTP3ç«¯å£
sudo ufw allow 8443/udp

# å…è®¸å‰ç«¯ç«¯å£
sudo ufw allow 3000/tcp

# é‡æ–°åŠ è½½é˜²ç«å¢™
sudo ufw reload
```

**Linuxé˜²ç«å¢™ï¼ˆfirewalldï¼‰**ï¼š
```bash
# å…è®¸QUICç«¯å£
sudo firewall-cmd --permanent --add-port=8080/udp

# å…è®¸HTTP3ç«¯å£
sudo firewall-cmd --permanent --add-port=8443/udp

# å…è®¸å‰ç«¯ç«¯å£
sudo firewall-cmd --permanent --add-port=3000/tcp

# é‡æ–°åŠ è½½é˜²ç«å¢™
sudo firewall-cmd --reload
```

### SSL/TLSè¯ä¹¦é…ç½®

Demoç‰ˆæœ¬ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨æ­£å¼è¯ä¹¦ã€‚

**ç”Ÿæˆè‡ªç­¾åè¯ä¹¦**ï¼š
```bash
# åˆ›å»ºè¯ä¹¦ç›®å½•
mkdir -p certs

# ç”Ÿæˆç§é’¥å’Œè¯ä¹¦
openssl req -x509 -newkey rsa:4096 -keyout certs/key.pem -out certs/cert.pem -days 365 -nodes \
  -subj "/C=CN/ST=Beijing/L=Beijing/O=Demo/CN=localhost"

# éªŒè¯è¯ä¹¦
openssl x509 -in certs/cert.pem -text -noout
```

**é…ç½®å¹³å°ç«¯ä½¿ç”¨è¯ä¹¦**ï¼š

ç¼–è¾‘ `platform-server/config.toml`ï¼š
```toml
[tls]
cert_path = "../certs/cert.pem"
key_path = "../certs/key.pem"
```

---

## å¯åŠ¨å’Œåœæ­¢

### å¯åŠ¨æœåŠ¡

**æ–¹å¼1: æ‰‹åŠ¨å¯åŠ¨ï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰**
```bash
# ç»ˆç«¯1: å¯åŠ¨å¹³å°ç«¯
cd platform-server && cargo run --release

# ç»ˆç«¯2: å¯åŠ¨è®¾å¤‡ç«¯
cd device-simulator && cargo run --release

# ç»ˆç«¯3: å¯åŠ¨å‰ç«¯
cd web-frontend && npm start
```

**æ–¹å¼2: ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰**
```bash
# ä½¿ç”¨å‰é¢åˆ›å»ºçš„å¯åŠ¨è„šæœ¬
./start-all.sh  # Linux/macOS
.\start-all.ps1  # Windows
```

**æ–¹å¼3: ä½¿ç”¨è¿›ç¨‹ç®¡ç†å™¨ï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰**
```bash
# ä½¿ç”¨PM2ç®¡ç†Node.jsè¿›ç¨‹
npm install -g pm2

# å¯åŠ¨å‰ç«¯
cd web-frontend
pm2 start npm --name "video-frontend" -- start

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs video-frontend
```

### åœæ­¢æœåŠ¡

**æ–¹å¼1: æ‰‹åŠ¨åœæ­¢**
```bash
# åœ¨å„ä¸ªç»ˆç«¯æŒ‰ Ctrl+C åœæ­¢æœåŠ¡
```

**æ–¹å¼2: ä½¿ç”¨è¿›ç¨‹IDåœæ­¢**
```bash
# æŸ¥æ‰¾è¿›ç¨‹
ps aux | grep platform-server
ps aux | grep device-simulator
ps aux | grep node

# åœæ­¢è¿›ç¨‹
kill <PID>

# å¼ºåˆ¶åœæ­¢
kill -9 <PID>
```

**æ–¹å¼3: ä½¿ç”¨åœæ­¢è„šæœ¬**
```bash
# åˆ›å»ºåœæ­¢è„šæœ¬ stop-all.sh
cat > stop-all.sh << 'EOF'
#!/bin/bash
pkill -f platform-server
pkill -f device-simulator
pkill -f "npm start"
echo "æ‰€æœ‰æœåŠ¡å·²åœæ­¢"
EOF

chmod +x stop-all.sh
./stop-all.sh
```

### é‡å¯æœåŠ¡

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
./stop-all.sh

# ç­‰å¾…2ç§’
sleep 2

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start-all.sh
```


---

## éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

**æ£€æŸ¥å¹³å°ç«¯**ï¼š
```bash
# æ£€æŸ¥QUICç«¯å£
netstat -an | grep 8080  # Linux/macOS
netstat -an | findstr 8080  # Windows

# æ£€æŸ¥HTTP3ç«¯å£
netstat -an | grep 8443  # Linux/macOS
netstat -an | findstr 8443  # Windows

# æ£€æŸ¥è¿›ç¨‹
ps aux | grep platform-server  # Linux/macOS
tasklist | findstr platform-server  # Windows
```

**æ£€æŸ¥è®¾å¤‡ç«¯**ï¼š
```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep device-simulator  # Linux/macOS
tasklist | findstr device-simulator  # Windows

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/device-simulator.log
```

**æ£€æŸ¥å‰ç«¯**ï¼š
```bash
# æ£€æŸ¥ç«¯å£
netstat -an | grep 3000  # Linux/macOS
netstat -an | findstr 3000  # Windows

# è®¿é—®å‰ç«¯
curl http://localhost:3000
```

### 2. åŠŸèƒ½æµ‹è¯•

#### 2.1 æµ‹è¯•è®¾å¤‡è¿æ¥

è®¿é—®å‰ç«¯ï¼šhttp://localhost:3000

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® http://localhost:3000
2. åº”è¯¥çœ‹åˆ°è®¾å¤‡åˆ—è¡¨é¡µé¢
3. ç¡®è®¤è®¾å¤‡ "device_001" æ˜¾ç¤ºä¸º "åœ¨çº¿" çŠ¶æ€

**é¢„æœŸç»“æœ**ï¼š
```
è®¾å¤‡åˆ—è¡¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‘„åƒå¤´-01                           â”‚
â”‚ çŠ¶æ€: åœ¨çº¿ ğŸŸ¢                       â”‚
â”‚ å»¶è¿Ÿ: 15ms                          â”‚
â”‚ å¸¦å®½: 8.5 Mbps                      â”‚
â”‚ [ç›´é€šæ’­æ”¾] [æŸ¥çœ‹å½•åƒ]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2 æµ‹è¯•å½•åƒæŸ¥è¯¢

1. ç‚¹å‡» "æŸ¥çœ‹å½•åƒ" æŒ‰é’®
2. åº”è¯¥çœ‹åˆ°å½•åƒæ–‡ä»¶åˆ—è¡¨
3. ç¡®è®¤æ˜¾ç¤ºæµ‹è¯•è§†é¢‘æ–‡ä»¶

**é¢„æœŸç»“æœ**ï¼š
```
å½•åƒæ–‡ä»¶åˆ—è¡¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ç¼©ç•¥å›¾] test_video_1080p_30fps.h264â”‚
â”‚ æ—¶é•¿: 01:00                         â”‚
â”‚ å¤§å°: 45.2 MB                       â”‚
â”‚ åˆ›å»ºæ—¶é—´: 2025-12-12 08:00          â”‚
â”‚ [æ’­æ”¾] [ä¸‹è½½] [è¯¦æƒ…]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3 æµ‹è¯•å½•åƒå›æ”¾

1. ç‚¹å‡»æŸä¸ªå½•åƒçš„ "æ’­æ”¾" æŒ‰é’®
2. è§†é¢‘åº”è¯¥å¼€å§‹æ’­æ”¾
3. æµ‹è¯•æ’­æ”¾æ§åˆ¶ï¼š
   - æš‚åœ/æ’­æ”¾
   - æ‹–åŠ¨è¿›åº¦æ¡
   - è°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼ˆ0.5x, 1x, 2xï¼‰

**é¢„æœŸç»“æœ**ï¼š
- è§†é¢‘æµç•…æ’­æ”¾ï¼Œæ— å¡é¡¿
- æ’­æ”¾æ§åˆ¶å“åº”è¿…é€Ÿ
- è¿›åº¦æ¡æ‹–åŠ¨å‡†ç¡®

#### 2.4 æµ‹è¯•ç›´é€šæ’­æ”¾

1. è¿”å›è®¾å¤‡åˆ—è¡¨
2. ç‚¹å‡» "ç›´é€šæ’­æ”¾" æŒ‰é’®
3. åº”è¯¥çœ‹åˆ°å®æ—¶è§†é¢‘æµ

**é¢„æœŸç»“æœ**ï¼š
- å»¶è¿Ÿ < 200ms
- è§†é¢‘æµç•…ï¼Œæ— æ˜æ˜¾å¡é¡¿
- å®æ—¶æ€§èƒ½ç»Ÿè®¡æ˜¾ç¤ºæ­£å¸¸

### 3. æ€§èƒ½éªŒè¯

#### 3.1 å»¶è¿Ÿæµ‹è¯•

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹æ€§èƒ½ç»Ÿè®¡ï¼š

```
æ€§èƒ½ç›‘æ§
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç«¯åˆ°ç«¯å»¶è¿Ÿ: 85ms                    â”‚
â”‚ ä¼ è¾“å»¶è¿Ÿ: 15ms                      â”‚
â”‚ å¤„ç†å»¶è¿Ÿ: 5ms                       â”‚
â”‚ æ¸²æŸ“å»¶è¿Ÿ: 65ms                      â”‚
â”‚                                     â”‚
â”‚ ååé‡: 5.2 Mbps                    â”‚
â”‚ ä¸¢åŒ…ç‡: 0.01%                       â”‚
â”‚ ç¼“å†²åŒº: å¥åº· (28.5s)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éªŒè¯æ ‡å‡†**ï¼š
- âœ… ç«¯åˆ°ç«¯å»¶è¿Ÿ < 200ms
- âœ… ä¸¢åŒ…ç‡ < 2%
- âœ… ç¼“å†²åŒºå¥åº·åº¦ > 80%

#### 3.2 èµ„æºä½¿ç”¨æµ‹è¯•

**æ£€æŸ¥CPUä½¿ç”¨ç‡**ï¼š
```bash
# Linux
top -p $(pgrep platform-server)

# macOS
top -pid $(pgrep platform-server)

# Windows
tasklist /FI "IMAGENAME eq platform-server.exe"
```

**æ£€æŸ¥å†…å­˜ä½¿ç”¨**ï¼š
```bash
# Linux
ps aux | grep platform-server | awk '{print $6}'

# macOS
ps aux | grep platform-server | awk '{print $6}'
```

**éªŒè¯æ ‡å‡†**ï¼š
- âœ… CPUä½¿ç”¨ç‡ < 50%ï¼ˆå•æ ¸ï¼‰
- âœ… å†…å­˜ä½¿ç”¨ < 500MBï¼ˆå¹³å°ç«¯ï¼‰
- âœ… å†…å­˜ä½¿ç”¨ < 200MBï¼ˆè®¾å¤‡ç«¯ï¼‰

### 4. æ—¥å¿—æ£€æŸ¥

**æŸ¥çœ‹å¹³å°ç«¯æ—¥å¿—**ï¼š
```bash
tail -f logs/platform-server.log

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
[INFO] Device device_001 connected
[INFO] Session 550e8400-e29b-41d4-a716-446655440000 started
[INFO] Segment received: latency=12ms, size=2048 bytes
[INFO] Client web_client_001 subscribed to session
```

**æŸ¥çœ‹è®¾å¤‡ç«¯æ—¥å¿—**ï¼š
```bash
tail -f logs/device-simulator.log

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
[INFO] Connected to platform: 127.0.0.1:8080
[INFO] Device registered: device_001
[INFO] Sending segment: timestamp=15.5s, size=2048 bytes
[INFO] Transmission stats: throughput=9.4 Mbps, latency=12ms
```

**æ£€æŸ¥é”™è¯¯æ—¥å¿—**ï¼š
```bash
# æŸ¥æ‰¾é”™è¯¯
grep ERROR logs/*.log

# æŸ¥æ‰¾è­¦å‘Š
grep WARN logs/*.log

# åº”è¯¥æ²¡æœ‰ä¸¥é‡é”™è¯¯
```

---

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### é—®é¢˜1: å¹³å°ç«¯å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
Error: Address already in use (os error 98)
```

**åŸå› **ï¼šç«¯å£è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8080  # Linux/macOS
netstat -ano | findstr :8080  # Windows

# åœæ­¢å ç”¨è¿›ç¨‹
kill <PID>  # Linux/macOS
taskkill /PID <PID> /F  # Windows

# æˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶ä½¿ç”¨å…¶ä»–ç«¯å£
```

#### é—®é¢˜2: è®¾å¤‡ç«¯æ— æ³•è¿æ¥å¹³å°ç«¯

**ç—‡çŠ¶**ï¼š
```
[ERROR] Failed to connect to platform: Connection refused
```

**åŸå› **ï¼šå¹³å°ç«¯æœªå¯åŠ¨æˆ–é˜²ç«å¢™é˜»æ­¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. ç¡®è®¤å¹³å°ç«¯å·²å¯åŠ¨
ps aux | grep platform-server

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -an | grep 8080

# 3. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status  # Linux
netsh advfirewall show allprofiles  # Windows

# 4. æµ‹è¯•è¿æ¥
nc -zv 127.0.0.1 8080  # Linux/macOS
Test-NetConnection -ComputerName 127.0.0.1 -Port 8080  # Windows
```

#### é—®é¢˜3: å‰ç«¯æ— æ³•è¿æ¥å¹³å°ç«¯

**ç—‡çŠ¶**ï¼š
```
WebSocket connection failed
```

**åŸå› **ï¼šCORSé…ç½®æˆ–è¯ä¹¦é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. ç¡®è®¤å¹³å°ç«¯é…ç½®å¯ç”¨äº†CORS
# ç¼–è¾‘ platform-server/config.toml
[demo]
enable_cors = true

# 2. æµè§ˆå™¨ä¿¡ä»»è‡ªç­¾åè¯ä¹¦
# è®¿é—® https://localhost:8443
# ç‚¹å‡» "é«˜çº§" -> "ç»§ç»­è®¿é—®"

# 3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
# F12 -> Console
```

#### é—®é¢˜4: è§†é¢‘æ— æ³•æ’­æ”¾

**ç—‡çŠ¶**ï¼šè§†é¢‘é»‘å±æˆ–åŠ è½½å¤±è´¥

**åŸå› **ï¼šè§†é¢‘æ ¼å¼ä¸æ”¯æŒæˆ–æ–‡ä»¶æŸå

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥è§†é¢‘æ–‡ä»¶æ ¼å¼
ffprobe test-videos/video.h264

# 2. éªŒè¯è§†é¢‘æ–‡ä»¶å®Œæ•´æ€§
ffmpeg -v error -i test-videos/video.h264 -f null -

# 3. è½¬æ¢ä¸ºæ”¯æŒçš„æ ¼å¼
ffmpeg -i input.mp4 -c:v libx264 -an output.h264

# 4. æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
# Chrome/Edge: å®Œå…¨æ”¯æŒ
# Firefox: éœ€è¦å®‰è£…H.264è§£ç å™¨
# Safari: éƒ¨åˆ†æ”¯æŒ
```

#### é—®é¢˜5: å»¶è¿Ÿè¿‡é«˜

**ç—‡çŠ¶**ï¼šå»¶è¿Ÿ > 500ms

**åŸå› **ï¼šç½‘ç»œæ‹¥å¡æˆ–é…ç½®ä¸å½“

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
ping 127.0.0.1

# 2. å¯ç”¨ä½å»¶è¿Ÿæ¨¡å¼
# ç¼–è¾‘ platform-server/config.toml
[server]
latency_threshold_ms = 100

# 3. è°ƒæ•´ç¼“å†²åŒºå¤§å°
# ç¼–è¾‘ web-frontend/.env
REACT_APP_BUFFER_SIZE=10

# 4. æ£€æŸ¥ç³»ç»Ÿèµ„æº
top  # Linux/macOS
taskmgr  # Windows
```

### è°ƒè¯•æŠ€å·§

#### å¯ç”¨è¯¦ç»†æ—¥å¿—

**å¹³å°ç«¯**ï¼š
```toml
# ç¼–è¾‘ platform-server/config.toml
[logging]
level = "debug"  # æˆ– "trace" è·å–æ›´è¯¦ç»†æ—¥å¿—
```

**è®¾å¤‡ç«¯**ï¼š
```toml
# ç¼–è¾‘ device-simulator/config.toml
[logging]
level = "debug"
```

**å‰ç«¯**ï¼š
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
localStorage.setItem('debug', 'video-streaming:*');
```

#### ç½‘ç»œæŠ“åŒ…

```bash
# ä½¿ç”¨tcpdumpæŠ“å–QUICæµé‡
sudo tcpdump -i any -w capture.pcap udp port 8080

# ä½¿ç”¨Wiresharkåˆ†æ
wireshark capture.pcap
```

#### æ€§èƒ½åˆ†æ

```bash
# ä½¿ç”¨perfåˆ†æCPUæ€§èƒ½ï¼ˆLinuxï¼‰
perf record -g ./target/release/platform-server
perf report

# ä½¿ç”¨Instrumentsåˆ†æï¼ˆmacOSï¼‰
instruments -t "Time Profiler" ./target/release/platform-server
```


---

## æ€§èƒ½ä¼˜åŒ–

### ç³»ç»Ÿçº§ä¼˜åŒ–

#### Linuxç³»ç»Ÿä¼˜åŒ–

```bash
# 1. å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
sudo vim /etc/security/limits.conf
# æ·»åŠ ä»¥ä¸‹è¡Œï¼š
* soft nofile 65536
* hard nofile 65536

# 2. ä¼˜åŒ–ç½‘ç»œå‚æ•°
sudo vim /etc/sysctl.conf
# æ·»åŠ ä»¥ä¸‹è¡Œï¼š
net.core.rmem_max = 134217728
net.core.wmem_max = 134217728
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864
net.core.netdev_max_backlog = 5000
net.ipv4.tcp_congestion_control = bbr

# åº”ç”¨é…ç½®
sudo sysctl -p

# 3. ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡
sudo systemctl disable bluetooth
sudo systemctl disable cups
```

#### Windowsç³»ç»Ÿä¼˜åŒ–

```powershell
# 1. å¢åŠ UDPç¼“å†²åŒº
netsh int udp set global udpchecksumcoverage=enabled

# 2. ç¦ç”¨Windows Defenderå®æ—¶ä¿æŠ¤ï¼ˆä»…æµ‹è¯•ç¯å¢ƒï¼‰
Set-MpPreference -DisableRealtimeMonitoring $true

# 3. è®¾ç½®é«˜æ€§èƒ½ç”µæºè®¡åˆ’
powercfg /setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c
```

### åº”ç”¨çº§ä¼˜åŒ–

#### å¹³å°ç«¯ä¼˜åŒ–

```toml
# ç¼–è¾‘ platform-server/config.toml

[server]
# å¢åŠ å¹¶å‘æµæ•°é‡
max_concurrent_streams = 200

# å¯ç”¨é›¶æ‹·è´ä¼ è¾“
enable_zero_copy = true

# å¯ç”¨æ‰¹é‡å‘é€
enable_batch_send = true
batch_size = 10

[storage]
# å¢åŠ ç¼“å­˜å¤§å°
cache_size_mb = 2048

# å¯ç”¨é¢„è¯»
enable_prefetch = true
prefetch_size_mb = 100

[performance]
# å¯ç”¨æ€§èƒ½ç›‘æ§
enable_monitoring = true
monitoring_interval_sec = 5

# å¯ç”¨è‡ªé€‚åº”ä¼˜åŒ–
enable_adaptive_optimization = true
```

#### è®¾å¤‡ç«¯ä¼˜åŒ–

```toml
# ç¼–è¾‘ device-simulator/config.toml

[performance]
# å¯ç”¨ç½‘ç»œè‡ªé€‚åº”
enable_network_adaptation = true

# å¯ç”¨é›¶æ‹·è´
enable_zero_copy = true

# è°ƒæ•´å‘é€ç¼“å†²åŒº
send_buffer_size_mb = 10

[keyframe_index]
# ä½¿ç”¨åˆ†å±‚ç´¢å¼•ç­–ç•¥
optimization_strategy = "Hierarchical"
memory_limit_mb = 200
```

#### å‰ç«¯ä¼˜åŒ–

```javascript
// ç¼–è¾‘ web-frontend/src/config.js

export const config = {
  // å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ
  enableHardwareAcceleration: true,
  
  // è°ƒæ•´ç¼“å†²åŒº
  bufferSize: 20, // ç§’
  
  // å¯ç”¨WebWorker
  useWebWorker: true,
  
  // å¯ç”¨OffscreenCanvas
  useOffscreenCanvas: true,
};
```

### æ•°æ®åº“ä¼˜åŒ–ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

å¦‚æœå‡çº§åˆ°ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ•°æ®åº“ï¼š

```sql
-- PostgreSQLä¼˜åŒ–
-- 1. å¢åŠ è¿æ¥æ± 
ALTER SYSTEM SET max_connections = 200;

-- 2. ä¼˜åŒ–æŸ¥è¯¢ç¼“å­˜
ALTER SYSTEM SET shared_buffers = '2GB';
ALTER SYSTEM SET effective_cache_size = '6GB';

-- 3. åˆ›å»ºç´¢å¼•
CREATE INDEX idx_recordings_device_id ON recordings(device_id);
CREATE INDEX idx_recordings_created_time ON recordings(created_time);
CREATE INDEX idx_sessions_device_id ON sessions(device_id);

-- 4. å¯ç”¨æŸ¥è¯¢è®¡åˆ’ç¼“å­˜
ALTER SYSTEM SET plan_cache_mode = 'force_generic_plan';
```

---

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### ä½¿ç”¨Systemdç®¡ç†æœåŠ¡ï¼ˆLinuxï¼‰

#### åˆ›å»ºå¹³å°ç«¯æœåŠ¡

```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
sudo vim /etc/systemd/system/video-platform.service
```

```ini
[Unit]
Description=Video Streaming Platform Server
After=network.target

[Service]
Type=simple
User=videostream
Group=videostream
WorkingDirectory=/opt/video-streaming/platform-server
ExecStart=/opt/video-streaming/platform-server/target/release/platform-server
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

# èµ„æºé™åˆ¶
LimitNOFILE=65536
LimitNPROC=4096

# ç¯å¢ƒå˜é‡
Environment="RUST_LOG=info"
Environment="RUST_BACKTRACE=1"

[Install]
WantedBy=multi-user.target
```

#### åˆ›å»ºè®¾å¤‡ç«¯æœåŠ¡

```bash
sudo vim /etc/systemd/system/video-device.service
```

```ini
[Unit]
Description=Video Streaming Device Simulator
After=network.target video-platform.service
Requires=video-platform.service

[Service]
Type=simple
User=videostream
Group=videostream
WorkingDirectory=/opt/video-streaming/device-simulator
ExecStart=/opt/video-streaming/device-simulator/target/release/device-simulator
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

#### å¯ç”¨å’Œç®¡ç†æœåŠ¡

```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯ç”¨æœåŠ¡ï¼ˆå¼€æœºè‡ªå¯ï¼‰
sudo systemctl enable video-platform
sudo systemctl enable video-device

# å¯åŠ¨æœåŠ¡
sudo systemctl start video-platform
sudo systemctl start video-device

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status video-platform
sudo systemctl status video-device

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u video-platform -f
sudo journalctl -u video-device -f

# åœæ­¢æœåŠ¡
sudo systemctl stop video-platform
sudo systemctl stop video-device

# é‡å¯æœåŠ¡
sudo systemctl restart video-platform
sudo systemctl restart video-device
```

### ä½¿ç”¨Nginxåå‘ä»£ç†

```nginx
# /etc/nginx/sites-available/video-streaming

upstream video_platform {
    server 127.0.0.1:8443;
}

server {
    listen 443 ssl http2;
    server_name video.example.com;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/letsencrypt/live/video.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/video.example.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/video-streaming-access.log;
    error_log /var/log/nginx/video-streaming-error.log;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /opt/video-streaming/web-frontend/build;
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass https://video_platform;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶é…ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # WebSocketä»£ç†
    location /ws/ {
        proxy_pass https://video_platform;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_read_timeout 86400;
    }
}

# HTTPé‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name video.example.com;
    return 301 https://$server_name$request_uri;
}
```

```bash
# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/video-streaming /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½Nginx
sudo systemctl reload nginx
```

### ä½¿ç”¨Dockeréƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

#### Dockerfileç¤ºä¾‹

**å¹³å°ç«¯Dockerfile**ï¼š
```dockerfile
# platform-server/Dockerfile
FROM rust:1.70 as builder

WORKDIR /app
COPY Cargo.toml Cargo.lock ./
COPY src ./src

RUN cargo build --release

FROM debian:bullseye-slim
RUN apt-get update && apt-get install -y ca-certificates && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY --from=builder /app/target/release/platform-server .
COPY config.toml .

EXPOSE 8080/udp 8443/udp

CMD ["./platform-server"]
```

**docker-compose.yml**ï¼š
```yaml
version: '3.8'

services:
  platform:
    build: ./platform-server
    ports:
      - "8080:8080/udp"
      - "8443:8443/udp"
    volumes:
      - ./recordings:/app/recordings
      - ./logs:/app/logs
    environment:
      - RUST_LOG=info
    restart: unless-stopped

  device:
    build: ./device-simulator
    depends_on:
      - platform
    volumes:
      - ./test-videos:/app/test-videos
    environment:
      - RUST_LOG=info
    restart: unless-stopped

  frontend:
    build: ./web-frontend
    ports:
      - "3000:80"
    depends_on:
      - platform
    restart: unless-stopped
```

```bash
# æ„å»ºå’Œå¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢
docker-compose down
```

---

## ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—ç®¡ç†

```bash
# æ—¥å¿—è½®è½¬é…ç½®
sudo vim /etc/logrotate.d/video-streaming
```

```
/opt/video-streaming/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    notifempty
    create 0640 videostream videostream
    sharedscripts
    postrotate
        systemctl reload video-platform
        systemctl reload video-device
    endscript
}
```

### å¤‡ä»½ç­–ç•¥

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /opt/video-streaming/backup.sh << 'EOF'
#!/bin/bash

BACKUP_DIR="/backup/video-streaming"
DATE=$(date +%Y%m%d_%H%M%S)

# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf $BACKUP_DIR/config_$DATE.tar.gz \
    platform-server/config.toml \
    device-simulator/config.toml \
    web-frontend/.env

# å¤‡ä»½å½•åƒæ–‡ä»¶ï¼ˆå¯é€‰ï¼Œæ–‡ä»¶è¾ƒå¤§ï¼‰
# tar -czf $BACKUP_DIR/recordings_$DATE.tar.gz recordings/

# åˆ é™¤30å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete

echo "Backup completed: $DATE"
EOF

chmod +x /opt/video-streaming/backup.sh

# æ·»åŠ åˆ°crontabï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½ï¼‰
crontab -e
# æ·»åŠ ï¼š0 2 * * * /opt/video-streaming/backup.sh
```

### å¥åº·æ£€æŸ¥

```bash
# åˆ›å»ºå¥åº·æ£€æŸ¥è„šæœ¬
cat > /opt/video-streaming/health-check.sh << 'EOF'
#!/bin/bash

# æ£€æŸ¥å¹³å°ç«¯
if ! systemctl is-active --quiet video-platform; then
    echo "Platform server is down, restarting..."
    systemctl restart video-platform
fi

# æ£€æŸ¥è®¾å¤‡ç«¯
if ! systemctl is-active --quiet video-device; then
    echo "Device simulator is down, restarting..."
    systemctl restart video-device
fi

# æ£€æŸ¥ç«¯å£
if ! nc -zv 127.0.0.1 8080 2>&1 | grep -q succeeded; then
    echo "QUIC port 8080 is not responding"
fi

if ! nc -zv 127.0.0.1 8443 2>&1 | grep -q succeeded; then
    echo "HTTP3 port 8443 is not responding"
fi
EOF

chmod +x /opt/video-streaming/health-check.sh

# æ·»åŠ åˆ°crontabï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
crontab -e
# æ·»åŠ ï¼š*/5 * * * * /opt/video-streaming/health-check.sh
```

---

## æ€»ç»“

æœ¬éƒ¨ç½²æŒ‡å—æ¶µç›–äº†ä»ç¯å¢ƒå‡†å¤‡åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æµç¨‹ã€‚å…³é”®è¦ç‚¹ï¼š

1. **Demoéƒ¨ç½²**ï¼šé€‚åˆå¿«é€ŸéªŒè¯å’Œå¼€å‘æµ‹è¯•
2. **ç”Ÿäº§éƒ¨ç½²**ï¼šéœ€è¦è€ƒè™‘å®‰å…¨ã€æ€§èƒ½ã€ç›‘æ§ç­‰å› ç´ 
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ ¹æ®å®é™…è´Ÿè½½è°ƒæ•´é…ç½®å‚æ•°
4. **æ•…éšœæ’æŸ¥**ï¼šç†Ÿæ‚‰å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
5. **æŒç»­ç»´æŠ¤**ï¼šå®šæœŸå¤‡ä»½ã€ç›‘æ§ã€æ›´æ–°

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- [APIæ¥å£æ–‡æ¡£](./APIæ¥å£æ–‡æ¡£.md)
- [å¼€å‘æ‰‹å†Œ](./å¼€å‘æ‰‹å†Œ.md)
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](./å¿«é€Ÿå¼€å§‹æŒ‡å—.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-12-12  
**ç»´æŠ¤è€…**: ç³»ç»Ÿæ¶æ„å›¢é˜Ÿ
