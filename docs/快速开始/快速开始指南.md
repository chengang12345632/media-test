# HTTP3/QUIC视频流传输系统 - 快速开始指南

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | v1.0 |
| 创建日期 | 2025-12-12 |
| 预计时间 | 15分钟 |
| 难度等级 | ⭐ 入门 |

## 目标

通过本指南，你将在15分钟内：
1. ✅ 搭建完整的开发环境
2. ✅ 启动所有服务（平台端、设备端、前端）
3. ✅ 体验直通播放和录像回放功能
4. ✅ 了解系统的基本工作原理

---

## 前置要求

### 系统要求
- 操作系统: Windows 10/11, Linux, macOS
- CPU: 4核心或更多
- 内存: 8GB RAM或更多
- 磁盘: 10GB可用空间

### 软件要求
- Rust 1.70+ （[安装指南](https://rustup.rs/)）
- Node.js 18+ （[安装指南](https://nodejs.org/)）
- Git （[安装指南](https://git-scm.com/)）

---

## 步骤1: 克隆项目 (2分钟)

```bash
# 克隆项目仓库
git clone https://github.com/your-org/video-streaming-demo.git
cd video-streaming-demo

# 查看项目结构
ls -la
```

**预期输出**：
```
drwxr-xr-x  platform-server/
drwxr-xr-x  device-simulator/
drwxr-xr-x  web-frontend/
drwxr-xr-x  docs/
-rw-r--r--  README.md
```

---

## 步骤2: 准备测试视频 (3分钟)

### 方式1: 下载示例视频（推荐）

```bash
cd device-simulator
mkdir -p test-videos

# 下载示例视频（约10MB）
curl -L -o test-videos/sample_1080p.h264 \
  https://example.com/samples/sample_1080p.h264

# 验证文件
ls -lh test-videos/
```

### 方式2: 使用ffmpeg生成测试视频

```bash
cd device-simulator
mkdir -p test-videos

# 生成30秒测试视频
ffmpeg -f lavfi -i testsrc=duration=30:size=1920x1080:rate=30 \
       -c:v libx264 -preset fast -crf 23 \
       test-videos/test_video_30s.h264

# 验证文件
ls -lh test-videos/
```

**预期输出**：
```
-rw-r--r--  test_video_30s.h264  (约15MB)
```

---

## 步骤3: 启动平台端服务器 (3分钟)

```bash
# 打开新终端窗口
cd platform-server

# 首次编译（需要3-5分钟）
cargo build --release

# 启动服务器
cargo run --release
```

**预期输出**：
```
[INFO] Platform server starting...
[INFO] Loading configuration from config.toml
[INFO] QUIC server listening on 0.0.0.0:8080
[INFO] HTTP3 server listening on 0.0.0.0:8443
[INFO] Recording manager initialized
[INFO] Scanning recordings directory...
[INFO] Platform server ready! 🚀
```

**✅ 成功标志**: 看到 "Platform server ready!" 消息

---

## 步骤4: 启动设备模拟器 (2分钟)

```bash
# 打开新终端窗口
cd device-simulator

# 编译（需要2-3分钟）
cargo build --release

# 启动设备模拟器
cargo run --release
```

**预期输出**：
```
[INFO] Device simulator starting...
[INFO] Device ID: device_001
[INFO] Device Name: 模拟摄像头-01
[INFO] Connecting to platform: 127.0.0.1:8080
[INFO] QUIC connection established ✓
[INFO] Device registered successfully ✓
[INFO] Found 1 test video(s) in ./test-videos
[INFO] Building keyframe index...
[INFO] Keyframe index built: 900 entries
[INFO] Device simulator ready! 🎥
```

**✅ 成功标志**: 看到 "Device simulator ready!" 消息

---

## 步骤5: 启动Web前端 (3分钟)

```bash
# 打开新终端窗口
cd web-frontend

# 安装依赖（首次需要2-3分钟）
npm install

# 启动开发服务器
npm start
```

**预期输出**：
```
Compiled successfully!

You can now view video-streaming-frontend in the browser.

  Local:            http://localhost:3000
  On Your Network:  http://192.168.1.100:3000

webpack compiled successfully
```

**✅ 成功标志**: 浏览器自动打开 http://localhost:3000

---

## 步骤6: 体验功能 (2分钟)

### 6.1 查看设备列表

1. 浏览器会自动打开前端页面
2. 你应该看到设备列表页面
3. 确认设备 "模拟摄像头-01" 显示为 "在线" 状态

**页面截图**：
```
┌─────────────────────────────────────────┐
│  HTTP3/QUIC 视频流传输系统              │
├─────────────────────────────────────────┤
│  设备列表                               │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │ 📹 模拟摄像头-01                  │ │
│  │ 状态: 在线 🟢                     │ │
│  │ 延迟: 15ms                        │ │
│  │ 带宽: 8.5 Mbps                    │ │
│  │                                   │ │
│  │ [直通播放] [查看录像]             │ │
│  └───────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 6.2 查看录像列表

1. 点击 "查看录像" 按钮
2. 你应该看到测试视频文件
3. 显示文件名、时长、大小等信息

**页面截图**：
```
┌─────────────────────────────────────────┐
│  录像文件列表                           │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │ [缩略图]                          │ │
│  │ test_video_30s.h264               │ │
│  │ 时长: 00:30                       │ │
│  │ 大小: 15.2 MB                     │ │
│  │ 创建: 2025-12-12 08:00            │ │
│  │                                   │ │
│  │ [播放] [下载] [详情]              │ │
│  └───────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 6.3 测试录像回放

1. 点击某个录像的 "播放" 按钮
2. 视频播放器会打开并开始播放
3. 尝试以下操作：
   - ⏸️ 暂停/播放
   - ⏩ 拖动进度条
   - ⚡ 调整播放速度（0.5x, 1x, 2x）

**播放器界面**：
```
┌─────────────────────────────────────────┐
│  [视频画面]                             │
│                                         │
│  ▶️ ⏸️ ⏹️  [========●====]  00:15/00:30│
│                                         │
│  播放速度: [1.0x ▼]                     │
│  画质: [高清 ▼]                         │
│                                         │
│  性能统计:                              │
│  延迟: 85ms                             │
│  缓冲: 健康 (28.5s)                     │
│  吞吐量: 5.2 Mbps                       │
└─────────────────────────────────────────┘
```

### 6.4 测试直通播放（可选）

1. 返回设备列表
2. 点击 "直通播放" 按钮
3. 观察实时视频流
4. 查看延迟统计（应该 < 200ms）

---

## 验证清单

完成以下检查，确保系统正常运行：

- [ ] 平台端服务器启动成功，监听8080和8443端口
- [ ] 设备模拟器连接成功，显示为在线状态
- [ ] Web前端可以访问，显示设备列表
- [ ] 可以查看录像文件列表
- [ ] 录像回放功能正常，视频流畅播放
- [ ] 播放控制（暂停、拖动、倍速）响应正常
- [ ] 性能统计显示正常（延迟、吞吐量等）

**全部通过？恭喜！🎉 你已经成功搭建了完整的视频流传输系统！**

---

## 常见问题

### Q1: 平台端启动失败，提示端口被占用

**错误信息**：
```
Error: Address already in use (os error 98)
```

**解决方案**：
```bash
# 查找占用端口的进程
lsof -i :8080  # Linux/macOS
netstat -ano | findstr :8080  # Windows

# 停止占用进程
kill <PID>  # Linux/macOS
taskkill /PID <PID> /F  # Windows
```

### Q2: 设备端无法连接平台端

**错误信息**：
```
[ERROR] Failed to connect to platform: Connection refused
```

**解决方案**：
1. 确认平台端已启动
2. 检查防火墙设置
3. 验证配置文件中的地址正确

```bash
# 测试连接
nc -zv 127.0.0.1 8080  # Linux/macOS
Test-NetConnection -ComputerName 127.0.0.1 -Port 8080  # Windows
```

### Q3: 前端无法连接平台端

**错误信息**：
```
WebSocket connection failed
```

**解决方案**：
1. 浏览器访问 https://localhost:8443
2. 点击 "高级" -> "继续访问"（信任自签名证书）
3. 刷新前端页面

### Q4: 视频无法播放

**可能原因**：
- 视频格式不支持
- 浏览器不支持H.264解码

**解决方案**：
```bash
# 验证视频文件
ffprobe test-videos/video.h264

# 转换为支持的格式
ffmpeg -i input.mp4 -c:v libx264 -an output.h264

# 使用Chrome或Edge浏览器（完全支持H.264）
```

---

## 下一步

现在你已经成功运行了系统，可以：

1. 📖 **深入学习**：阅读[系统架构设计文档](../系统架构设计文档.md)
2. 🔧 **开发功能**：参考[开发手册](./开发手册.md)
3. 🚀 **部署生产**：查看[部署指南](./部署指南.md)
4. 📡 **调用API**：参考[API接口文档](./API接口文档.md)

---

## 获取帮助

遇到问题？

- 📧 邮件: support@example.com
- 💬 讨论区: https://github.com/your-org/video-streaming-demo/discussions
- 🐛 问题反馈: https://github.com/your-org/video-streaming-demo/issues

---

**文档版本**: v1.0  
**最后更新**: 2025-12-12  
**预计完成时间**: 15分钟  
**维护者**: 系统架构团队

---

## 附录：一键启动脚本

为了更快速地启动系统，可以使用以下脚本：

### Linux/macOS

```bash
# 创建启动脚本
cat > start-demo.sh << 'EOF'
#!/bin/bash

echo "🚀 启动 HTTP3/QUIC 视频流传输系统..."
echo ""

# 启动平台端
echo "1️⃣ 启动平台端服务器..."
cd platform-server
cargo run --release > ../logs/platform.log 2>&1 &
PLATFORM_PID=$!
echo "   平台端已启动 (PID: $PLATFORM_PID)"

# 等待5秒
sleep 5

# 启动设备端
echo "2️⃣ 启动设备模拟器..."
cd ../device-simulator
cargo run --release > ../logs/device.log 2>&1 &
DEVICE_PID=$!
echo "   设备端已启动 (PID: $DEVICE_PID)"

# 等待3秒
sleep 3

# 启动前端
echo "3️⃣ 启动Web前端..."
cd ../web-frontend
npm start > ../logs/frontend.log 2>&1 &
FRONTEND_PID=$!
echo "   前端已启动 (PID: $FRONTEND_PID)"

echo ""
echo "✅ 所有服务已启动！"
echo ""
echo "📊 服务状态:"
echo "   平台端: PID $PLATFORM_PID"
echo "   设备端: PID $DEVICE_PID"
echo "   前端:   PID $FRONTEND_PID"
echo ""
echo "🌐 访问地址: http://localhost:3000"
echo ""
echo "📝 日志文件:"
echo "   平台端: logs/platform.log"
echo "   设备端: logs/device.log"
echo "   前端:   logs/frontend.log"
echo ""
echo "🛑 停止所有服务: kill $PLATFORM_PID $DEVICE_PID $FRONTEND_PID"
EOF

chmod +x start-demo.sh
./start-demo.sh
```

### Windows (PowerShell)

```powershell
# 使用项目提供的启动脚本
# 首次运行需要先编译
powershell -ExecutionPolicy Bypass -File .\quick-test-setup.ps1

# 启动所有服务
powershell -ExecutionPolicy Bypass -File .\start-all-simple.ps1
```

**说明**: 如果遇到 "禁止运行脚本" 错误，使用 `-ExecutionPolicy Bypass` 参数可以临时绕过执行策略限制。

---

**祝你使用愉快！Happy Coding! 🎉**
